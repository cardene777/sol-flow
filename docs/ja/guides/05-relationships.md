# リレーションシップ（エッジ）

Sol-Flowでは、コントラクト間の関係性を「エッジ」と呼ばれる線で表現します。このガイドでは、各エッジの意味と読み方を説明します。

## エッジとは

ダイアグラム上でコントラクトノード同士を結ぶ線のことを「エッジ」と呼びます。エッジは、あるコントラクトが別のコントラクトとどのような関係にあるかを視覚的に示します。

以下の画像では、複数のコントラクト間の関係がエッジ（線）で表現されています。

![エッジ概要](../../guides/images/edges/edges-highlight.png)

エッジの色とスタイル（実線・破線）は、関係の種類を表しています。

## エッジの種類

Sol-Flowでは、関係の種類ごとに異なる色とスタイルでエッジを表示します。

### 継承（inherits）

あるコントラクトが別のコントラクトを継承している関係を示します。

```solidity
// MyTokenはERC20を継承しています
contract MyToken is ERC20 {
    // ERC20の機能を受け継いでいます
}
```

| 項目 | 内容 |
|-----|------|
| 色 | 青色 |
| スタイル | 実線 |
| 方向 | 子コントラクト → 親コントラクト |
| 意味 | 矢印の元が、矢印の先のコントラクトを継承しています |

### 実装（implements）

コントラクトがインターフェースを実装している関係を示します。インターフェースは通常「I」で始まる名前を持ちます（例: `IERC20`）。

```solidity
// MyTokenはIERC20インターフェースを実装しています
contract MyToken is IERC20 {
    // IERC20で定義された関数を全て実装しています
    function transfer(address to, uint256 amount) external returns (bool) { ... }
}
```

| 項目 | 内容 |
|-----|------|
| 色 | 紫色 |
| スタイル | 実線 |
| 方向 | 実装コントラクト → インターフェース |
| 意味 | 矢印の元が、矢印の先のインターフェースを実装しています |

継承と実装の違いは、継承先がインターフェースかどうかで自動判定されます（名前が「I」で始まり、2文字目が大文字の場合はインターフェースとして扱われます）。

### ライブラリ使用（uses）

コントラクトがライブラリを使用している関係を示します。

```solidity
// SafeMathライブラリをuint256型に対して使用
using SafeMath for uint256;

contract MyToken {
    function add(uint256 a, uint256 b) public pure returns (uint256) {
        return a.add(b);  // SafeMath.add を呼び出し
    }
}
```

| 項目 | 内容 |
|-----|------|
| 色 | 黄色/アンバー |
| スタイル | 破線 |
| 方向 | 使用側 → ライブラリ |
| 意味 | 矢印の元が、矢印の先のライブラリを使用しています |

### delegatecall

プロキシパターンで使用される特殊な呼び出し関係を示します。プロキシコントラクトが実装コントラクトのコードを自身のコンテキストで実行します。

```solidity
// プロキシが実装コントラクトにdelegatecallする
(bool success, ) = implementation.delegatecall(data);
```

| 項目 | 内容 |
|-----|------|
| 色 | ピンク |
| スタイル | 破線 |
| 方向 | プロキシ → 実装 |
| 意味 | 矢印の元（プロキシ）が、矢印の先（実装）のコードをdelegatecallで呼び出します |

### 登録（registers）

ERC-7546モジュラープロキシパターンで使用される関係です。辞書コントラクトに実装コントラクトが登録されていることを示します。

```solidity
// 辞書に関数セレクタと実装アドレスを登録
dictionary.setImplementation(bytes4(keccak256("transfer(address,uint256)")), implAddress);
```

| 項目 | 内容 |
|-----|------|
| 色 | バイオレット |
| スタイル | 破線 |
| 方向 | 辞書 → 実装 |
| 意味 | 矢印の元（辞書）に、矢印の先（実装）が登録されています |

## エッジの読み方

### 方向の意味

エッジの矢印は、「使用する側」から「使用される側」を指します。

```
MyToken ──inherits──> ERC20
  │
  └──uses──> SafeMath
```

上の例では:
- MyTokenはERC20を継承している（MyToken → ERC20）
- MyTokenはSafeMathを使用している（MyToken → SafeMath）

### 複数のエッジ

一つのコントラクトが複数のコントラクトと関係を持つ場合、複数のエッジが表示されます。

```
MyGovernanceToken ──inherits──> ERC20
       │              └──────> Ownable
       │                  └──> Pausable
       └──uses──> SafeMath
```

### エッジの選択

エッジをクリックすると、そのエッジがハイライトされます。多くのエッジがある複雑なダイアグラムで、特定の関係を確認したいときに便利です。

## 依存関係を理解する意義

### 継承関係を把握するメリット

継承関係を理解すると、以下のことが分かります。

| 分かること | 詳細 |
|-----------|------|
| 利用可能な関数 | 親コントラクトの関数も子コントラクトで使えます |
| オーバーライドの確認 | どの関数が親から継承され、どの関数がオーバーライドされているか |
| アクセス制御の継承 | 親コントラクトのmodifierやroleが子コントラクトに引き継がれているか |

### ライブラリ使用を把握するメリット

ライブラリの使用関係を理解すると、以下のことが分かります。

| 分かること | 詳細 |
|-----------|------|
| 使用されているユーティリティ | どのヘルパー関数が利用可能か |
| ガス最適化の可能性 | より効率的なライブラリへの置き換えの検討 |
| 共通パターンの発見 | 複数のコントラクトで同じライブラリが使われているか |

### プロキシ関係を把握するメリット

プロキシ関係を理解すると、以下のことが分かります。

| 分かること | 詳細 |
|-----------|------|
| アップグレードパス | どのコントラクトがアップグレード可能か |
| 実際のロジック | プロキシ経由で実行される実際のコードがどこにあるか |
| ストレージの所在 | データがどのコントラクトに保存されるか |

## カスタムエッジ

Sol-Flowでは、静的解析で検出されない関係を手動で追加することもできます。詳しくは[編集モード](./09-edit-mode.md)を参照してください。

## 次のステップ

- [コントラクト詳細](./06-contract-details.md) - コントラクトの詳細情報を確認する
- [プロキシパターン](./10-proxy-patterns.md) - プロキシ特有のエッジについて詳しく学ぶ
