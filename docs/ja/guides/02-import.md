# インポート

Sol-Flowでコントラクトを分析するには、まずSolidityファイルをインポートする必要があります。このガイドでは、ファイルのインポート方法と、インポート後の処理について説明します。

## インポート方法

Sol-Flowにコントラクトを取り込む方法は2つあります。どちらの方法でも同じ結果が得られますので、使いやすい方を選んでください。

### 方法1: ドラッグ＆ドロップ

最も手軽な方法です。ファイルマネージャー（Finder、エクスプローラーなど）からSolidityファイルをSol-Flowのウィンドウにドラッグして放すだけです。

![ドラッグ＆ドロップ](../../guides/images/import/import-drag.png)

1. ファイルマネージャーでインポートしたい`.sol`ファイルを選択します
2. ファイルをSol-Flowのブラウザウィンドウにドラッグします
3. 点線で囲まれたドロップゾーンが表示されたら、そこにファイルを放します

複数のファイルを同時に選択してドラッグすることもできます。また、フォルダごとドラッグすると、フォルダ内のすべての`.sol`ファイルがインポートされます。

### 方法2: Importボタンを使う

ヘッダーの「Import」ボタンを使う方法です。ファイル選択ダイアログが開くので、インポートしたいファイルを選択できます。

![インポートモーダル](../../guides/images/import/import-modal.png)

1. ヘッダー右端の「Import」ボタンをクリックします
2. インポートダイアログが開きます
3. 「Select Files」ボタンをクリックしてファイルを選択するか、ドロップゾーンにファイルをドラッグ＆ドロップします
4. プロジェクト名を入力します（オプション）
5. 「Import」ボタンをクリックしてインポートを実行します

## 対応しているファイル形式

### ファイル拡張子

現在、Sol-Flowは`.sol`拡張子のSolidityソースファイルのみをサポートしています。

| 拡張子 | 対応状況 | 説明 |
|-------|---------|------|
| `.sol` | ✅ 対応 | Solidityソースファイル |
| `.json` | ❌ 非対応 | ABIファイルは現在非対応 |

### Solidityバージョン

Sol-Flowは、幅広いSolidityバージョンに対応しています。

| バージョン | 対応状況 |
|-----------|---------|
| Solidity 0.4.x | ✅ 対応 |
| Solidity 0.5.x | ✅ 対応 |
| Solidity 0.6.x | ✅ 対応 |
| Solidity 0.7.x | ✅ 対応 |
| Solidity 0.8.x | ✅ 対応 |

`pragma solidity ^0.8.0;`のようなバージョン指定があるファイルも問題なく処理できます。

### インポート文の解決

Solidityファイル内のインポート文は、Sol-Flowが自動的に解決を試みます。

```solidity
// 相対パスのインポート - インポートしたファイル群から自動解決
import "./MyContract.sol";

// 名前付きインポート - 同様に自動解決
import {ERC20} from "./token/ERC20.sol";
```

**注意**: `@openzeppelin/contracts/...`のような外部パッケージからのインポートは、Sol-Flowの組み込みライブラリで解決されます。ただし、独自のパッケージやローカルの`node_modules`からのインポートは、必要なファイルをすべて含めてインポートする必要があります。

## インポート後の処理

ファイルをインポートすると、Sol-Flowは以下の処理を自動的に行います。

### 1. 構文解析（パース）

Solidityコードを解析して、コントラクトの構造（関数、変数、イベントなど）を抽出します。構文エラーがある場合は、この段階でエラーメッセージが表示されます。

### 2. 依存関係の分析

コントラクト間の関係性（継承、ライブラリ使用、インターフェース実装など）を分析します。

### 3. プロキシパターンの検出

ERC-1967、ERC-7546、ERC-2535（Diamond）などのプロキシパターンを自動的に検出します。

### 4. 可視化の生成

分析結果をもとに、キャンバス上にコントラクトノードとエッジ（関係線）を配置します。

インポートが完了すると、以下のようにコントラクトがダイアグラムとして表示されます。

![インポート後のダイアグラム](../../guides/images/canvas/canvas-overview.png)

## 組み込みライブラリ

Sol-Flowには、よく使われるライブラリがあらかじめ組み込まれています。これらのライブラリはインポートしなくても、サイドバーの「Libraries」ボタンから表示できます。

### OpenZeppelin Contracts

最も広く使われているスマートコントラクトライブラリです。

| カテゴリ | 含まれるコントラクト |
|---------|-------------------|
| トークン | ERC20、ERC721、ERC1155とその拡張 |
| アクセス制御 | Ownable、AccessControl、AccessManager |
| セキュリティ | ReentrancyGuard、Pausable |
| ユーティリティ | Address、Strings、Math |

### Solady

ガス効率を重視した軽量な実装を提供するライブラリです。OpenZeppelinより少ないガスコストで同等の機能を提供します。

### ERC-7546

モジュラープロキシパターンのリファレンス実装です。関数ごとに異なる実装コントラクトを呼び出せる、柔軟なプロキシ構造を提供します。

### Avalanche ICM

Avalancheブロックチェーンのクロスチェーンメッセージング（Interchain Messaging）用のライブラリです。

## ベストプラクティス

### プロジェクトの整理

効率的に分析を行うためのヒントです。

| 推奨事項 | 説明 |
|---------|------|
| 関連ファイルをまとめる | 一つのプロトコルに関連するコントラクトは、まとめてインポートすると依存関係が正しく解決されます |
| プロジェクトを分ける | 異なるプロトコルは別々のプロジェクトとして管理すると、ダイアグラムが見やすくなります |
| 必要なファイルのみ | テストファイルやスクリプトファイルは除外して、コアとなるコントラクトのみをインポートすると整理しやすくなります |

### パフォーマンスの考慮

大量のファイルをインポートする場合の注意点です。

| 状況 | 推奨 |
|-----|------|
| 小規模（〜20ファイル） | 一度にインポートしても問題ありません |
| 中規模（20〜50ファイル） | 若干の処理時間がかかりますが、問題なく動作します |
| 大規模（50ファイル以上） | 必要なコントラクトを絞ってインポートすることをお勧めします |

## トラブルシューティング

### パースエラーが表示される

コード内に構文エラーがある場合、パースに失敗します。

| 原因 | 対処法 |
|-----|-------|
| 構文エラー | エラーメッセージを確認し、コードを修正してから再インポート |
| 未対応の構文 | 非常に新しいSolidity機能は未対応の場合があります |

### 依存関係が解決できない

インポート文で指定したファイルが見つからない場合、エラーになります。

| 原因 | 対処法 |
|-----|-------|
| ファイル不足 | インポート先のファイルも一緒にインポートしてください |
| パスの不一致 | ファイル構造を確認し、必要なファイルがすべて含まれているか確認してください |

## 次のステップ

- [ナビゲーション](./03-navigation.md) - キャンバスの操作方法を学ぶ
- [コントラクトノード](./04-contract-nodes.md) - ノードの見方と操作方法を学ぶ
