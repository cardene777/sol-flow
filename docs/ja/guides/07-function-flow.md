# 関数フロー

Sol-Flowの関数フロー機能を使うと、ある関数が内部でどの関数を呼び出しているか、どのイベントを発行するかなどを視覚的に確認できます。このガイドでは、関数フローの見方と使い方を説明します。

![関数フローダイアログ](../../guides/images/function-flow/function-flow-modal.png)

## 関数フローを開く

関数フローを表示するには、コントラクトノード内の関数名をクリックします。

![ノード内の関数](../../guides/images/function-flow/function-click.gif)

1. キャンバス上でコントラクトノードを見つけます
2. ノード内に表示されている関数リストから、詳細を見たい関数名をクリックします
3. 関数フローダイアログが開きます

### 関数フローの例

以下は`transferFrom`関数の関数フローの例です。

![関数フロー例1](../../guides/images/function-flow/function-flow-modal.png)

## 関数フローダイアログの構成

関数フローダイアログは、選択した関数についての詳細情報を表示します。

### 関数の基本情報

ダイアログのヘッダー部分には、関数の基本情報が表示されます。

| 表示項目 | 説明 |
|---------|------|
| 関数名 | 選択した関数の名前（例: `transfer`） |
| 所属コントラクト | この関数が定義されているコントラクト名 |
| 可視性 | `external`、`public`、`internal`、`private` のいずれか |
| 状態変更性 | `view`（状態を読むだけ）、`pure`（計算のみ）、`payable`（ETH受付可能）、`nonpayable`（デフォルト） |

### パラメータと戻り値

関数の入力パラメータと戻り値が表示されます。

| 項目 | 説明 |
|-----|------|
| Parameters | 関数に渡す引数の名前と型（例: `to: address`, `amount: uint256`） |
| Returns | 関数が返す値の型（例: `bool`） |

## 呼び出しフローの見方

関数フローの中心となる部分で、選択した関数が内部でどのような処理を行っているかを視覚的に表示します。

### 呼び出しの種類

関数フローでは、呼び出しの種類ごとに異なる色で表示されます。

| 色 | 呼び出しの種類 | 説明 |
|---|-------------|------|
| 青 | 内部呼び出し（internal） | 同じコントラクト内の別の関数を呼び出す |
| 紫 | ライブラリ呼び出し | ライブラリの関数を呼び出す（例: `SafeMath.add`） |
| ピンク | 外部呼び出し（external） | 別のコントラクトの関数を呼び出す |
| オレンジ | super呼び出し | 親コントラクトの同名関数を呼び出す |
| 赤 | delegatecall | delegatecallを使った呼び出し |
| 緑 | イベント発行 | `emit`で発行されるイベント |
| グレー | モディファイア | 関数に適用されているモディファイア |

### 内部呼び出しの例

```solidity
function transfer(address to, uint256 amount) public returns (bool) {
    _transfer(msg.sender, to, amount);  // 内部呼び出し → 青で表示
    return true;
}
```

上記の`transfer`関数は、内部で`_transfer`関数を呼び出しています。関数フローでは、この呼び出しが青色のノードとして表示されます。

### ライブラリ呼び出しの例

```solidity
using SafeMath for uint256;

function add(uint256 a, uint256 b) public pure returns (uint256) {
    return a.add(b);  // ライブラリ呼び出し → 紫で表示
}
```

`SafeMath.add`の呼び出しは、紫色のノードとして表示されます。

### イベント発行の例

```solidity
function transfer(address to, uint256 amount) public returns (bool) {
    // ... 処理 ...
    emit Transfer(msg.sender, to, amount);  // イベント → 緑で表示
    return true;
}
```

発行されるイベントは、緑色のノードとして表示されます。

## モディファイアの表示

関数に適用されているモディファイアも確認できます。

```solidity
function mint(address to, uint256 amount) public onlyOwner whenNotPaused {
    // onlyOwner と whenNotPaused がモディファイアとして表示
}
```

よく見かけるモディファイアの例:

| モディファイア | 役割 |
|--------------|------|
| `onlyOwner` | オーナーのみが実行可能 |
| `nonReentrant` | リエントランシー攻撃を防止 |
| `whenNotPaused` | コントラクトが一時停止中でない場合のみ実行可能 |
| `initializer` | 初期化関数（アップグレード可能コントラクト用） |

## ソースコードの表示

関数フローダイアログには、選択した関数のソースコードも表示されます。シンタックスハイライト付きで、行番号も確認できます。

## 活用方法

### コードの理解

複雑な関数の処理フローを視覚的に把握できます。

| 確認できること | 説明 |
|--------------|------|
| 実行順序 | どの関数がどの順番で呼ばれるか |
| 依存関係 | この関数が動作するために必要な他の関数 |
| 副作用 | どのイベントが発行されるか |

### セキュリティレビュー

潜在的なセキュリティリスクを特定できます。

| チェックポイント | 確認すること |
|---------------|-------------|
| 外部呼び出し | リエントランシー攻撃のリスクがないか |
| delegatecall | 信頼できないコントラクトへの委譲がないか |
| アクセス制御 | 適切なモディファイアが適用されているか |
| イベント | 重要な操作にイベント発行があるか |

### ドキュメント作成

監査レポートや技術ドキュメントの作成時に、関数の動作を説明するのに役立ちます。

## 関連機能へのジャンプ

関数フロー内で表示されている呼び出し先をクリックすると、その関数の詳細にジャンプできる場合があります。これにより、呼び出しの連鎖を追いかけて、処理の全体像を把握できます。

## 閉じる方法

関数フローダイアログを閉じるには、以下のいずれかの方法を使います。

| 方法 | 操作 |
|-----|------|
| Xボタン | ダイアログ右上の✕ボタンをクリック |
| Escapeキー | キーボードの`Escape`キーを押す |
| 外側をクリック | ダイアログの外側（暗い背景部分）をクリック |

## 次のステップ

- [検索](./08-search.md) - 特定の関数を検索して素早くアクセスする
- [編集モード](./09-edit-mode.md) - カスタムの関係を追加する
