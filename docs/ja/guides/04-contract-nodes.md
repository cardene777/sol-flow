# コントラクトノード

Sol-Flowでは、各コントラクトが「ノード」という箱として表示されます。このガイドでは、ノードの見方と操作方法を説明します。

## ノードの種類

Solidityには複数の種類のコントラクト定義があり、Sol-Flowではそれぞれを視覚的に区別して表示します。

![ノードの例](../../guides/images/nodes/node-overview.png)

### コントラクト（通常のコントラクト）

最も一般的なスマートコントラクトです。状態変数と関数を持ち、デプロイ可能です。

```solidity
contract MyToken {
    string public name = "My Token";
    function transfer(address to, uint256 amount) external { ... }
}
```

#### ノードの特徴

- 塗りつぶされた四角形のアイコン（▣）が表示されます
- 実装が完全に含まれています

### インターフェース

関数のシグネチャ（名前と引数の型）のみを定義し、実装を持たないコントラクトです。他のコントラクトが実装すべき「契約」を定義します。

```solidity
interface IERC20 {
    function transfer(address to, uint256 amount) external returns (bool);
    function balanceOf(address account) external view returns (uint256);
}
```

#### ノードの特徴

- ダイヤモンド形のアイコン（◇）が表示されます
- 関数の実装がなく、シグネチャのみです

### ライブラリ

再利用可能なユーティリティ関数をまとめたものです。状態を持たず、他のコントラクトから呼び出されて使用されます。

```solidity
library SafeMath {
    function add(uint256 a, uint256 b) internal pure returns (uint256) {
        return a + b;
    }
}
```

#### ノードの特徴

- 「Library」というバッジが表示される場合があります
- 単独でデプロイされることは稀です

### 抽象コントラクト

一部の関数のみを実装し、残りを継承先のコントラクトに委ねるコントラクトです。単独ではデプロイできません。

```solidity
abstract contract Ownable {
    address public owner;

    modifier onlyOwner() {
        require(msg.sender == owner, "Not owner");
        _;
    }

    // 実装されていない関数
    function renounceOwnership() public virtual;
}
```

#### ノードの特徴

- 塗りつぶされていない四角形のアイコン（▢）が表示されます
- 一部の関数が未実装のままです

## ノードの構成要素

各ノードは、いくつかのセクションで構成されています。

### ヘッダー部分

ノードの上部にあるヘッダーには、以下の情報が表示されます。

| 要素 | 説明 |
|-----|------|
| アイコン | コントラクトの種類を示します（▣ = コントラクト、◇ = インターフェース、▢ = 抽象） |
| コントラクト名 | コントラクトの名前 |
| 詳細ボタン | ℹ️ アイコン。クリックするとコントラクト詳細モーダルが開きます |
| カテゴリバッジ | Access Control、Financeなどのカテゴリを示すラベル |

![ノードの構成](../../guides/images/nodes/node-collapsed.png)

### ライブラリバッジ

外部ライブラリのコントラクトには、ヘッダーの上にライブラリ名とバージョンが表示されます。

| ライブラリ | 表示例 |
|-----------|-------|
| OpenZeppelin | 📦 OpenZeppelin@5.0.2 |
| Solady | 📦 Solady |

![ライブラリバッジの例](../../guides/images/nodes/library-badge.png)

### プロキシパターンバッジ

プロキシパターンを使用しているコントラクトには、パターンの種類と役割が表示されます。

| パターン | 表示例 |
|---------|-------|
| ERC-1967 (UUPS) | 「UUPS」と「🔀 Proxy」または「⚡ Impl」 |
| ERC-7546 | 「ERC-7546」と「📖 Dict」「🔀 Proxy」「⚡ Impl」など |
| Diamond (ERC-2535) | 「Diamond」と「💎 Facet」 |

![proxy-badge](../../guides/images/proxy-patterns/proxy-badge.png)

### 関数リスト

ノードの中央部分には、そのコントラクトの関数が一覧表示されます。

![function-list](../../guides/images/function-flow/function-list.png)

**External / Public セクション**

外部から呼び出せる関数が表示されます。さらに以下のように分類されています。

| 分類 | 説明 |
|-----|------|
| view / pure | 状態を変更しない読み取り専用の関数（緑色の丸印） |
| state-changing | 状態を変更する関数（オレンジ色の丸印） |

**Internal / Private セクション**

コントラクト内部でのみ呼び出せる関数が表示されます。このセクションは折りたたみ可能で、「▶ Internal / Private」の部分をクリックして展開・折りたたみできます。

### フッター部分

ノードの下部には、統計情報が表示されます。

| 表示 | 意味 |
|-----|------|
| X ext | 外部/パブリック関数の数 |
| Y int | 内部/プライベート関数の数 |
| Z events | イベントの数 |

## ノードの操作

### 関数をクリックする

関数名をクリックすると、その関数の「関数フロー」ダイアログが開きます。
関数フローでは、その関数が内部でどの関数を呼び出しているか、どのイベントを発行するかなどを確認できます。

詳しくは[関数フロー](./07-function-flow.md)を参照してください。

### 詳細ボタン（ℹ️）をクリックする

ノードヘッダーの詳細ボタン（ℹ️アイコン）をクリックすると、コントラクト詳細モーダルが開きます。
ここでは、関数だけでなく、状態変数、構造体、イベント、エラー、そしてソースコードを確認できます。

詳しくは[コントラクト詳細](./06-contract-details.md)を参照してください。

### ノードを移動する

ノードをドラッグして、ダイアグラム上の好きな位置に移動できます。位置は自動的に保存されます。

![ノードのドラッグ](../../guides/images/nodes/node-drag.gif)

### Internal/Private セクションを展開・折りたたむ

「▶ Internal / Private」または「▼ Internal / Private」をクリックすると、内部関数のセクションを展開または折りたたむことができます。

![function-internal](../../guides/images/function-flow/function-internal.png)

## 効率的な使い方

### 見やすいダイアグラムにするコツ

| ヒント | 説明 |
|-------|------|
| よく見るノードは展開 | 頻繁に確認するコントラクトの内部関数セクションは展開しておくと便利です |
| 関連ノードを近くに | 継承関係にあるコントラクトや、よく一緒に使うコントラクトは近くに配置しましょう |
| 不要なセクションは折りたたむ | 内部関数を確認する必要がないノードは折りたたんでおくと、ダイアグラムがすっきりします |

### 情報を効率的に取得する

| 目的 | 方法 |
|-----|------|
| 関数の詳細を見たい | 関数名をクリックして関数フローを開く |
| ソースコードを見たい | 詳細ボタン（ℹ️）をクリックして「Source」タブを選択 |
| 状態変数を確認したい | 詳細ボタン（ℹ️）をクリックして「Variables」タブを選択 |
| イベント一覧を見たい | 詳細ボタン（ℹ️）をクリックして「Events」タブを選択 |

## 次のステップ

- [リレーションシップ](./05-relationships.md) - ノード間を結ぶ線（エッジ）の意味を理解する
- [コントラクト詳細](./06-contract-details.md) - 詳細モーダルの使い方を学ぶ
